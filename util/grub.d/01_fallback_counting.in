#! /bin/sh -e

if ! systemctl -q is-enabled greenboot.service >/dev/null 2>&1 ; then
  exit 0
fi

# Boot Counting
cat << EOF
insmod increment
if [ -z "\${boot_counter}" ]; then
  set boot_counter=0
elif [ "\${boot_counter}" = "0" -o "\${boot_counter}" = "-1" ]; then
  increment default
  set boot_counter=-1
else
  decrement boot_counter
fi
save_env boot_counter
EOF
